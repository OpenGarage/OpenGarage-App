{"version":3,"file":"app.min.js","sources":["app.min.js"],"sourcesContent":["/* global angular, google */\n\n// OpenGarage\n// Controllers are found in controllers.js and utilities are located in utils.js\nangular.module( \"opengarage\", [ \"ionic\", \"uiCropper\", \"opengarage.controllers\", \"opengarage.utils\", \"opengarage.cloud\", \"opengarage.watch\" ] )\n\t.run( function( $state, $ionicPlatform, $ionicScrollDelegate, $document, $window, $rootScope, $filter, $ionicLoading, $timeout, Utils, Cloud, Watch ) {\n\n\t\t// Ready function fires when the DOM is ready and after deviceready event is fired if Cordova is being used\n\t\t$ionicPlatform.ready( function() {\n\n\t\t\t// Map inAppBrowser to rootScope\n\t\t\t$rootScope.open = function( url ) {\n\t\t\t\tif ( window.SafariViewController ) {\n\t\t\t\t\twindow.SafariViewController.isAvailable( function( available ) {\n\t\t\t\t\t\tif ( available ) {\n\t\t\t\t\t\t\twindow.SafariViewController.show( {\n\t\t\t\t\t\t\t\turl: url,\n\t\t\t\t\t\t\t\ttintColor: \"#444444\",\n\t\t\t\t\t\t\t\tbarColor: \"#444444\",\n\t\t\t\t\t\t\t\tcontrolTintColor: \"#ffffff\"\n\t\t\t\t\t\t\t} );\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\twindow.open( url, \"_blank\", \"toolbarposition=top\" );\n\t\t\t\t\t\t}\n\t\t\t\t\t} );\n\t\t\t\t} else {\n\t\t\t\t\twindow.open( url, \"_blank\", \"toolbarposition=top\" );\n\t\t\t\t}\n\t\t\t};\n\n\t\t\t// Hide the accessory bar by default (remove this to show the accessory bar above the keyboard\n\t\t\t// for form inputs)\n\t\t\tif ( window.cordova && window.cordova.plugins && window.cordova.plugins.Keyboard && window.cordova.plugins.Keyboard.hideKeyboardAccessoryBar ) {\n\t\t\t\twindow.cordova.plugins.Keyboard.hideKeyboardAccessoryBar( true );\n\t\t\t}\n\t\t\tif ( window.StatusBar ) {\n\n\t\t\t\t// Use white text/icons on the status bar\n\t\t        window.StatusBar.styleLightContent();\n\n\t\t        //Change the status bar color to match the header\n                window.StatusBar.backgroundColorByHexString( \"#444\" );\n\n\t\t        // Scroll to the top of the page when the status bar is tapped\n\t\t\t\tangular.element( $window ).on( \"statusTap\", function() {\n\t\t\t\t\t$ionicScrollDelegate.scrollTop();\n\t\t        } );\n\t\t\t}\n\n\t\t\tif ( window.geofence ) {\n\t\t\t\t$rootScope.hasGeofence = true;\n\n\t\t\t\t$rootScope.startGeofence = function( callback ) {\n\t\t\t\t\twindow.geofence.initialize().then( function() {\n\t\t\t\t\t\tcallback( true );\n\t\t\t\t\t}, function() {\n\t\t\t\t\t\tcallback( false );\n\t\t\t\t\t} );\n\t\t\t\t};\n\n\t\t\t\twindow.geofence.getWatched( function( fences ) {\n\t\t\t\t\t$rootScope.geoFences = JSON.parse( fences );\n\t\t\t\t} );\n\n\t\t\t\tvar handleGeofence = function( geofences ) {\n\t\t\t\t\tif ( geofences ) {\n\n\t\t\t\t\t\t// Allow handler to process notification click event as well\n\t\t\t\t\t\tif ( geofences.notification ) {\n\t\t\t\t\t\t\tgeofences = [ geofences ];\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t$rootScope.$apply( function() {\n\t\t\t\t\t\t\tgeofences.forEach( function( geo ) {\n\t\t\t\t\t\t\t\tvar data = geo.notification.id.split( \"-\" ),\n\t\t\t\t\t\t\t\t\tcontroller = $filter( \"filter\" )( $rootScope.controllers, { \"mac\": data[ 1 ] } );\n\n\t\t\t\t\t\t\t\tif ( controller &&\n\t\t\t\t\t\t\t\t\t( data[ 0 ] === \"open\" && controller.door === 0 ) &&\n\t\t\t\t\t\t\t\t\t( data[ 0 ] === \"close\" && controller.door === 1 ) ) {\n\t\t\t\t\t\t\t\t\t\tUtils.toggleDoor( controller.auth, null, controller.bdmn + \":\" + controller.bprt );\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t} );\n\t\t\t\t\t\t} );\n\t\t\t\t\t}\n\t\t\t\t};\n\n\t\t\t\twindow.geofence.onTransitionReceived = handleGeofence;\n\t\t\t\twindow.geofence.onNotificationClicked = handleGeofence;\n\t\t\t}\n\n\t\t\tif ( window.ThreeDeeTouch ) {\n\t\t\t\tUtils.updateQuickLinks();\n\n\t\t\t\twindow.ThreeDeeTouch.enableLinkPreview();\n\n\t\t\t\twindow.ThreeDeeTouch.onHomeIconPressed = function( payload ) {\n\n\t\t\t\t\tvar data = payload.type.split( \"-\" );\n\n\t\t\t\t\tif ( data[ 0 ] === \"toggle\" ) {\n\t\t\t\t\t\tvar controller = $filter( \"filter\" )( $rootScope.controllers, { \"mac\": data[ 1 ] } );\n\t\t\t\t\t\tif ( controller ) {\n\t\t\t\t\t\t\tUtils.toggleDoor( controller.auth, null, controller.bdmn + \":\" + controller.bprt );\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t}\n\n\t\t\tif ( window.applewatch && window.navigator.simulator !== true ) {\n\t\t\t\twindow.applewatch.init( angular.noop );\n\n\t\t\t\twindow.toggleDoorByIndex = function( index ) {\n\t\t\t\t\tUtils.toggleDoor( $rootScope.controllers[ index ].auth, null, $rootScope.controllers[ index ].bdmn + \":\" + $rootScope.controllers[ index ].bprt );\n\t\t\t\t};\n\n\t\t\t\twindow.applewatch.callback.onLoadAppMainRequest = Watch.loadApp;\n\t\t\t}\n\n\t\t    // Hide the splash screen after 500ms of the app being ready\n\t\t    $timeout( function() {\n\t\t        try {\n\t\t            navigator.splashscreen.hide();\n\t\t        } catch ( err ) {}\n\t\t    }, 500 );\n\t\t} );\n\n\t\t// Define connected state of current controller\n\t\t$rootScope.connected = false;\n\n\t\t// Define version, build number and debug state\n\t\t$rootScope.version = window.appVersion;\n\n\t    // Define total loading requests\n\t    $rootScope.loadingQueue = [];\n\n\t    // Initialize controllers array\n\t    $rootScope.controllers = [];\n\n\t\t// Automatically show a loading message on any AJAX request\n\t\t$rootScope.$on( \"loading:show\", function( e, data ) {\n\t\t\tvar scope = $rootScope.$new();\n\n\t\t\tscope.canceller = data ? data.canceller.resolve : function() {\n\t\t\t\t$rootScope.$broadcast( \"loading:hide\" );\n\t\t\t};\n\n\t\t\t$rootScope.loadingQueue.push( scope.canceller );\n\t\t\t$ionicLoading.show( {\n\t\t\t\ttemplate: \"<ion-spinner></ion-spinner><br>One moment please<br><button class='button white icon-left ion-ios-close-outline button-clear' ng-click='canceller()'>Cancel</button>\",\n\t\t\t\tscope: scope\n\t\t\t} );\n\t\t} );\n\n\t\t// Automatically hide the loading message after an AJAX request\n\t\t$rootScope.$on( \"loading:hide\", function() {\n\n\t\t\t$rootScope.loadingQueue.pop();\n\t\t\t$ionicLoading.hide();\n\t\t\tif ( $rootScope.loadingQueue.length > 0 ) {\n\t\t\t\tvar scope = $rootScope.$new();\n\t\t\t\tscope.canceller = $rootScope.loadingQueue[ $rootScope.loadingQueue.length - 1 ];\n\t\t\t\t$ionicLoading.show( {\n\t\t\t\t\ttemplate: \"<ion-spinner></ion-spinner><br>One moment please<br><button class='button white icon-left ion-ios-close-outline button-clear' ng-click='canceller()'>Cancel</button>\",\n\t\t\t\t\tscope: scope\n\t\t\t\t} );\n\t\t\t}\n\t\t} );\n\n\t\t// Keep the page title locked as the app name\n\t\t$rootScope.$on( \"$ionicView.afterEnter\", function() {\n\t\t\t$document[ 0 ].title = \"OpenGarage\";\n\t\t} );\n\n\t\tangular.element( $document ).on( \"resume\", function() {\n\t\t\t$timeout( function() {\n\t\t\t\tUtils.checkNewController();\n\t\t\t\tCloud.sync();\n\t\t\t}, 100 );\n\t\t} );\n\n\t\t// Handle loading of the first page\n\t\tvar firstLoadHandler = $rootScope.$on( \"$stateChangeStart\", function( event ) {\n\n\t\t\t// Unbind event handler so this check is only performed on the first app load\n\t\t    firstLoadHandler();\n\n\t\t    // Prevent any page change from occurring\n\t        event.preventDefault();\n\n\t\t    Utils.storage.get( [ \"activeController\", \"controllers\", \"cloudToken\" ], function( data ) {\n\n\t\t\t\ttry {\n\t\t\t\t\t$rootScope.controllers = JSON.parse( data.controllers );\n\t\t\t\t\t$rootScope.activeController = JSON.parse( data.activeController );\n\t\t\t\t} catch ( err ) {}\n\n\t\t\t\tif ( !$rootScope.controllers ) {\n\t\t\t\t\t$rootScope.controllers = [];\n\t\t\t\t}\n\n\t\t\t\tif ( !$rootScope.activeController || typeof $rootScope.activeController !== \"object\" ) {\n\t\t\t\t\t$rootScope.activeController = {};\n\t\t\t\t}\n\n\t\t\t\tCloud.sync();\n\n\t\t\t\t// Restore the active controller, if available\n\t\t        if ( Object.keys( $rootScope.activeController ).length ) {\n\n\t\t\t\t\t// If a user object is cached, proceed to load the app while updating user object in the background\n\t\t\t\t\t$state.go( \"app.home\" );\n\n\t\t\t\t\tUtils.updateController();\n\t\t        } else {\n\t\t\t\t\tif ( $rootScope.controllers.length || data.cloudToken ) {\n\t\t\t\t\t\t$state.go( \"app.controllerSelect\" );\n\t\t\t\t\t} else {\n\t\t\t\t\t\t$state.go( \"login\" );\n\t\t\t\t\t}\n\t\t        }\n\t\t    } );\n\n\t\t    Utils.checkNewController();\n\t\t} );\n\n\t\t// Resize the main content view to fit when the window changes size\n\t\tangular.element( window ).on( \"resize\", function() {\n\t\t\t$rootScope.$broadcast( \"window:resize\" );\n\t\t\tvar content = document.getElementById( \"mainContent\" );\n\t\t\tif ( content && window.innerWidth > 768 ) {\n\t\t\t\tcontent.width = window.innerWidth - 275;\n\t\t\t}\n\t\t} );\n\t} )\n\n\t.config( function( $stateProvider, $httpProvider, $compileProvider, $ionicConfigProvider ) {\n\n\t\tif ( /MSIE\\s|Trident\\/|Edge\\//.test( window.navigator.userAgent ) ) {\n\n\t\t\t// Change the default spinner for IE to android which has JS based animation\n\t\t\t$ionicConfigProvider.platform.default.spinner.icon( \"android\" );\n\t\t}\n\n\t\t// Change the back text to always say 'Back'\n\t\t$ionicConfigProvider.backButton.previousTitleText( false ).text( \"Back\" );\n\n\t\t// Use native scrolling for FireFox\n\t\tif ( /Firefox/.test( navigator.userAgent ) ) {\n\t\t\t$ionicConfigProvider.scrolling.jsScrolling( false );\n\t\t}\n\n\t\t// Modify Ionic's allowed href protocols to allow Firefox, Blackberry, iOS and Chrome support\n\t\t$compileProvider.aHrefSanitizationWhitelist( /^\\s*(https?|ftp|mailto|chrome-extension|app|local|file):/ );\n\n\t\t// Modify Ionic's allowed image source protocols\n\t\t$compileProvider.imgSrcSanitizationWhitelist( /^\\s*(https?|ftp|file|content|blob|ms-appx|x-wmapp0|chrome-extension|app|local):|data:image\\// );\n\n\t\t// Define all available routes and their associated controllers\n\t\t$stateProvider\n\t\t\t.state( \"login\", {\n\t\t\t\turl: \"/login\",\n\t\t\t\ttemplateUrl: \"templates/login.html\",\n\t\t\t\tcontroller: \"LoginCtrl\"\n\t\t\t} )\n\n\t\t\t// Used as the parent route after authentication is complete allowing the same header\n\t\t\t// and side menu's to be used throughout all child views\n\t\t\t.state( \"app\", {\n\t\t\t\turl: \"/app\",\n\t\t\t\tabstract: true,\n\t\t\t\ttemplateUrl: \"templates/menu.html\",\n\t\t\t\tcontroller: \"MenuCtrl\"\n\t\t\t} )\n\n\t\t\t.state( \"app.home\", {\n\t\t\t\turl: \"/home\",\n\t\t\t\tviews: {\n\t\t\t\t\tmenuContent: {\n\t\t\t\t\t\ttemplateUrl: \"templates/home.html\",\n\t\t\t\t\t\tcontroller: \"HomeCtrl\"\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tresolve: {\n\t\t\t\t\tcheckValid: function( $timeout, $q, $state, $rootScope, $filter, Utils ) {\n\t\t\t\t\t\tvar total = $rootScope.controllers.length,\n\t\t\t\t\t\t\tfilterFilter = $filter( \"filter\" ),\n\t\t\t\t\t\t\tinvalidOrg = ( $rootScope.activeController && filterFilter( $rootScope.controllers, { \"mac\": $rootScope.activeController.mac } ).length === 0 ) ? true : false;\n\n\t\t\t\t\t\tif ( !$rootScope.activeController && total === 1 ) {\n\t\t\t\t\t\t\tUtils.setController( 0 );\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif ( !$rootScope.activeController || invalidOrg ) {\n\n\t\t\t\t\t\t\tdelete $rootScope.activeController;\n\t\t\t\t\t\t\tUtils.storage.remove( \"activeController\" );\n\n\t\t\t\t\t\t\t// If the active controller is not found in the controller list, show the select controller screen\n\t\t\t\t\t\t\t$timeout( function() {\n\t\t\t\t\t\t\t\t$state.go( \"app.controllerSelect\" );\n\t\t\t\t\t\t\t} );\n\n\t\t\t\t\t\t\treturn $q.reject();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} )\n\n\t\t\t.state( \"app.rules\", {\n\t\t\t\turl: \"/rules\",\n\t\t\t\tviews: {\n\t\t\t\t\tmenuContent: {\n\t\t\t\t\t\ttemplateUrl: \"templates/rules.html\",\n\t\t\t\t\t\tcontroller: \"RulesCtrl\"\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} )\n\n\t\t\t.state( \"app.controllerSelect\", {\n\t\t\t\turl: \"/controllerSelect\",\n\t\t\t\tviews: {\n\t\t\t\t\tmenuContent: {\n\t\t\t\t\t\ttemplateUrl: \"templates/controllerSelect.html\",\n\t\t\t\t\t\tcontroller: \"ControllerSelectCtrl\"\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} )\n\n\t\t\t.state( \"app.history\", {\n\t\t\t\turl: \"/history\",\n\t\t\t\tviews: {\n\t\t\t\t\tmenuContent: {\n\t\t\t\t\t\ttemplateUrl: \"templates/history.html\",\n\t\t\t\t\t\tcontroller: \"HistoryCtrl\"\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tresolve: {\n\t\t\t\t\tcheckValid: function( $rootScope, $q ) {\n\t\t\t\t\t\tif ( !$rootScope.activeController ) {\n\t\t\t\t\t\t\treturn $q.reject();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} )\n\n\t\t\t.state( \"app.settings\", {\n\t\t\t\turl: \"/settings\",\n\t\t\t\tviews: {\n\t\t\t\t\tmenuContent: {\n\t\t\t\t\t\ttemplateUrl: \"templates/settings.html\",\n\t\t\t\t\t\tcontroller: \"SettingsCtrl\"\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tresolve: {\n\t\t\t\t\tcheckValid: function( $rootScope, $q ) {\n\t\t\t\t\t\tif ( !$rootScope.activeController ) {\n\t\t\t\t\t\t\treturn $q.reject();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} )\n\n\t\t\t.state( \"app.help\", {\n\t\t\t\turl: \"/help\",\n\t\t\t\tviews: {\n\t\t\t\t\tmenuContent: {\n\t\t\t\t\t\ttemplateUrl: \"templates/help.html\"\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} )\n\n\t\t\t// Defines the otherwise route which will redirect any invalid URL back to the start page\n\t\t\t.state( \"otherwise\", {\n\t\t\t\turl: \"*path\",\n\t\t\t\ttemplate: \"\",\n\t\t\t\tcontroller: function( $state, $rootScope ) {\n\n\t\t\t\t\tif ( $rootScope.activeController ) {\n\t\t\t\t\t\t$state.go( \"app.home\" );\n\t\t\t\t\t} else {\n\t\t\t\t\t\t$state.go( \"app.controllerSelect\" );\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} );\n\n\t\t// Add an HTTP interceptor\n\t\t$httpProvider.interceptors.push( function( $rootScope, $q, $injector ) {\n\t\t\treturn {\n\t\t\t\trequest: function( config ) {\n\n\t\t\t\t\t// When an AJAX request to the controller is started, fire an event to show a loading message\n\t\t\t\t\tif ( config.url.match( /^https?/ ) ) {\n\n\t\t\t\t\t\t// Change timeout to a promise we can cancel\n\t\t\t\t\t\tconfig.cancel = $q.defer();\n\n\t\t\t\t\t\t// Set the timeout to the canceller promise\n\t\t\t\t\t\tconfig.timeout = config.cancel.promise;\n\n\t\t\t\t\t\t// Set the current retry count to 0\n\t\t\t\t\t\tif ( typeof config.retryCount !== \"number\" ) {\n\t\t\t\t\t\t\tconfig.retryCount = 0;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif ( !config.suppressLoader ) {\n\t\t\t\t\t\t\t$rootScope.$broadcast( \"loading:show\", { canceller: config.cancel } );\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\treturn config;\n\t\t\t\t},\n\t\t\t\tresponse: function( response ) {\n\n\t\t\t\t\t// If the request is to the controller, broadcast a hide loading message\n\t\t\t\t\tif ( !response.config.suppressLoader && response.config.url.match( /^https?/ ) ) {\n\t\t\t\t\t\t$rootScope.$broadcast( \"loading:hide\" );\n\t\t\t\t\t}\n\n\t\t\t\t\treturn response;\n\t\t\t\t},\n\t\t\t\tresponseError: function( error ) {\n\n\t\t\t\t\t// If the timeout value is an object and is resolved, mark request as user canceled\n\t\t\t\t\tif ( error.config.timeout && error.config.timeout.$$state && error.config.timeout.$$state.status === 1 ) {\n\t\t\t\t\t\terror.canceled = true;\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( !error.config.suppressLoader && error.config.url.match( /^https?/ ) ) {\n\t\t\t\t\t\t$rootScope.$broadcast( \"loading:hide\" );\n\t\t\t\t\t}\n\n\t\t\t\t\t// If the request timed out and is not user canceled, retry the request up to three times\n\t\t\t\t\tif ( error.status <= 0 && !error.canceled ) {\n\t\t\t\t\t\tif ( error.config.retryCount < 3 ) {\n\t\t\t\t\t\t\tvar $http = $injector.get( \"$http\" );\n\n\t\t\t\t\t\t\terror.config.retryCount++;\n\n\t\t\t\t\t\t\t// Return the new promise object\n\t\t\t\t\t\t\treturn $http( error.config );\n\t\t\t\t\t\t} else {\n\n\t\t\t\t\t\t\t// After three timeouts, assume the network is down\n\t\t\t\t\t\t\terror.retryFailed = true;\n\t\t\t\t\t\t\terror.canceled = true;\n\n\t\t\t\t\t\t\treturn $q.reject( error );\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\treturn $q.reject( error );\n\t\t\t\t}\n\t\t\t};\n\t\t} );\n\n\t\t// Inform Ionic we want to cache forward views\n\t\t$ionicConfigProvider.views.forwardCache( true );\n\t} )\n\n\t.filter( \"unique\", function() {\n\t\treturn function( items, filterOn ) {\n\t\t\tif ( filterOn === false ) {\n\t\t\t\treturn items;\n\t\t\t}\n\n\t\t\tif ( ( filterOn || angular.isUndefined( filterOn ) ) && angular.isArray( items ) ) {\n\t\t\t\tvar newItems = [],\n\t\t\t\t\textractValueToCompare = function( item ) {\n\t\t\t\t\t\tif ( angular.isObject( item ) && angular.isString( filterOn ) ) {\n\t\t\t\t\t\t\treturn item[ filterOn ];\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\treturn item;\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\n\t\t\t\tangular.forEach( items, function( item ) {\n\t\t\t\t\tvar isDuplicate = false;\n\n\t\t\t\t\tfor ( var i = 0; i < newItems.length; i++ ) {\n\t\t\t\t\t\tif ( angular.equals( extractValueToCompare( newItems[ i ] ), extractValueToCompare( item ) ) ) {\n\t\t\t\t\t\t\tisDuplicate = true;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tif ( !isDuplicate ) {\n\t\t\t\t\t\tnewItems.push( item );\n\t\t\t\t\t}\n\t\t\t\t} );\n\t\t\t\titems = newItems;\n\t\t\t}\n\t\treturn items;\n\t\t};\n\t} )\n\n\t.directive( \"geoRuleSetup\", function( $rootScope, $filter ) {\n\t\treturn {\n\t\t\trestrict: \"E\",\n\t\t\treplace: true,\n\t\t\tscope: {\n\t\t\t\trule: \"=\"\n\t\t\t},\n\t\t\ttemplateUrl: \"templates/geoRuleSetup.html\",\n\t\t\tlink: function( scope, element ) {\n\t\t\t\tvar map, marker, circle;\n\n\t\t\t\tscope.updateRule = function() {\n\t\t\t\t\t$rootScope.startGeofence( function() {\n\t\t\t\t\t\twindow.geofence.addOrUpdate( {\n\t\t\t\t\t\t\tid: scope.rule.direction + \"-\" + $rootScope.activeController.mac,\n\t\t\t\t\t\t\tlatitude: scope.rule.start.lat,\n\t\t\t\t\t\t\tlongitude: scope.rule.start.lng,\n\t\t\t\t\t\t\tradius: scope.rule.radius,\n\t\t\t\t\t\t\ttransitionType: scope.rule.direction === \"open\" ? 1 : 2,\n\t\t\t\t\t\t\tnotification: {\n\t\t\t\t\t\t\t\ttitle: \"OpenGarage Reminder\",\n\t\t\t\t\t\t\t\ttext: \"Tap here to \" + scope.rule.direction + \" the garage door...\",\n\t\t\t\t\t\t\t\topenAppOnClick: true\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}, function() {\n\t\t\t\t\t\t\twindow.geofence.getWatched( function( fences ) {\n\t\t\t\t\t\t\t\t$rootScope.geoFences = JSON.parse( fences );\n\t\t\t\t\t\t\t} );\n\t\t\t\t\t\t} );\n\t\t\t\t\t} );\n\t\t\t\t};\n\n\t\t\t\tscope.updateMarker = function() {\n\t\t\t\t\tif ( marker ) {\n\t\t\t\t\t\tmarker.setMap( null );\n\t\t\t\t\t}\n\n\t\t\t\t\tmarker = new google.maps.Marker( {\n\t\t\t\t\t\tposition: scope.rule.start,\n\t\t\t\t\t\tmap: map\n\t\t\t\t\t} );\n\n\t\t\t\t\tscope.updateRule();\n\t\t\t\t};\n\n\t\t\t\tscope.updateRadius = function() {\n\t\t\t\t\tif ( circle ) {\n\t\t\t\t\t\tcircle.setMap( null );\n\t\t\t\t\t}\n\n\t\t\t\t\tcircle = new google.maps.Circle( {\n\t\t\t\t\t\tstrokeColor: \"#FF0000\",\n\t\t\t\t\t\tstrokeOpacity: 0.8,\n\t\t\t\t\t\tstrokeWeight: 2,\n\t\t\t\t\t\tfillColor: \"#FF0000\",\n\t\t\t\t\t\tfillOpacity: 0.35,\n\t\t\t\t\t\tmap: map,\n\t\t\t\t\t\tcenter: scope.rule.start,\n\t\t\t\t\t\tradius: parseInt( scope.rule.radius )\n\t\t\t\t\t} );\n\n\t\t\t\t\tscope.updateRule();\n\t\t\t\t};\n\n\t\t\t\tscope.updateMap = function() {\n\t\t\t\t\tif ( !scope.rule.enable ) {\n\t\t\t\t\t\twindow.geofence.remove( scope.rule.direction + \"-\" + $rootScope.activeController.mac, function() {\n\t\t\t\t\t\t\twindow.geofence.getWatched( function( fences ) {\n\t\t\t\t\t\t\t\t$rootScope.geoFences = JSON.parse( fences );\n\t\t\t\t\t\t\t} );\n\t\t\t\t\t\t} );\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tsetTimeout( function() {\n\t\t\t\t\t\tmap = new google.maps.Map( element[ 0 ].querySelectorAll( \".map\" )[ 0 ], {\n\t\t\t\t\t\t\tzoom: 16,\n\t\t\t\t\t\t\tstreetViewControl: false,\n\t\t\t\t\t\t\tmapTypeControl: false,\n\t\t\t\t\t\t\tcenter: scope.rule.start\n\t\t\t\t\t\t} );\n\n\t\t\t\t\t\tgoogle.maps.event.addListener( map, \"click\", function( e ) {\n\t\t\t\t\t\t\tscope.rule.start = { lat: e.latLng.lat(), lng: e.latLng.lng() };\n\t\t\t\t\t\t\tscope.updateMarker();\n\t\t\t\t\t\t\tscope.updateRadius();\n\t\t\t\t\t\t} );\n\n\t\t\t\t\t\tscope.updateMarker();\n\t\t\t\t\t\tscope.updateRadius();\n\t\t\t\t\t}, 100 );\n\t\t\t\t};\n\n\t\t\t\tscope.$watch( \"rule\", function() {\n\t\t\t\t\tvar currentRule = $filter( \"filter\" )( $rootScope.geoFences, { \"id\": scope.rule.direction + \"-\" + $rootScope.activeController.mac } )[ 0 ];\n\n\t\t\t\t\tif ( currentRule ) {\n\t\t\t\t\t\tscope.rule.radius = currentRule.radius;\n\t\t\t\t\t\tscope.rule.start = { lat: currentRule.latitude, lng: currentRule.longitude };\n\t\t\t\t\t\tscope.rule.enable = true;\n\t\t\t\t\t\tscope.updateMap();\n\t\t\t\t\t} else {\n\t\t\t\t\t\tscope.rule.radius = scope.rule.radius || 500;\n\t\t\t\t\t\tscope.rule.start = scope.rule.start || { lat: 30.296519, lng: -97.730185 };\n\t\t\t\t\t\tscope.rule.enable = scope.rule.enable || false;\n\n\t\t\t\t\t\t$rootScope.startGeofence( function() {\n\t\t\t\t\t\t\tnavigator.geolocation.getCurrentPosition( function( position ) {\n\t\t\t\t\t\t\t\tscope.rule.start = { lat: position.coords.latitude, lng: position.coords.longitude };\n\t\t\t\t\t\t\t\tscope.updateMap();\n\t\t\t\t\t\t\t}, function() {\n\t\t\t\t\t\t\t\tscope.updateMap();\n\t\t\t\t\t\t\t}, { timeout: 10000 } );\n\t\t\t\t\t\t} );\n\t\t\t\t\t}\n\t\t\t\t} );\n\t\t\t}\n\t\t};\n\t} );\n\n/* global angular, sjcl */\n\n// OpenGarage\nangular.module( \"opengarage.cloud\", [ \"opengarage.utils\" ] )\n    .factory( \"Cloud\", [ \"$injector\", \"$rootScope\", \"Utils\", function( $injector, $rootScope, Utils ) {\n\n        var requestAuth = function() {\n                $ionicPopup = $ionicPopup || $injector.get( \"$ionicPopup\" );\n\n                var scope = $rootScope.$new();\n                scope.data = {};\n\n                $ionicPopup.show( {\n                    templateUrl: \"templates/cloudLogin.html\",\n                    title: \"OpenGarage.io Login\",\n                    scope: scope,\n                    buttons: [\n                        { text: \"Cancel\" },\n                        {\n                            text: \"<b>Login</b>\",\n                            type: \"button-positive\",\n                            onTap: function( e ) {\n                                if ( !scope.data.username || !scope.data.password ) {\n                                    e.preventDefault();\n                                    return;\n                                }\n\n                                return true;\n                            }\n                        }\n                    ]\n                } ).then( function( isValid ) {\n                    if ( isValid ) {\n                        login( scope.data.username, scope.data.password, syncStart );\n                    }\n                } );\n            },\n            login = function( user, pass, callback ) {\n                callback = callback || function() {};\n                $http = $http || $injector.get( \"$http\" );\n                $httpParamSerializerJQLike = $httpParamSerializerJQLike || $injector.get( \"$httpParamSerializerJQLike\" );\n\n                $http( {\n                    method: \"POST\",\n                    url: \"https://opengarage.io/wp-admin/admin-ajax.php\",\n\t\t\t\t\theaders: {\n\t\t\t\t\t\t\"Content-Type\": \"application/x-www-form-urlencoded; charset=UTF-8\"\n\t\t\t\t\t},\n                    data: $httpParamSerializerJQLike( {\n                        action: \"ajaxLogin\",\n                        username: user,\n                        password: pass\n                    } )\n                } ).then( function( result ) {\n                    if ( typeof result.data.token === \"string\" ) {\n                        Utils.storage.set( {\n                            \"cloudToken\": result.data.token,\n                            \"cloudDataToken\": sjcl.codec.hex.fromBits( sjcl.hash.sha256.hash( pass ) )\n                        } );\n                        $rootScope.isSynced = true;\n                    }\n                    callback( result.data.loggedin );\n                }, function() {\n                    callback( false );\n                } );\n            },\n            logout = function() {\n                Utils.storage.remove( \"cloudToken\" );\n                $rootScope.isSynced = false;\n            },\n            syncStart = function() {\n                $ionicActionSheet = $ionicActionSheet || $injector.get( \"$ionicActionSheet\" );\n\n                getSites( function( sites ) {\n                    if ( JSON.stringify( sites ) === JSON.stringify( $rootScope.controllers ) ) {\n                        return;\n                    }\n\n                    if ( Object.keys( sites ).length > 0 ) {\n\n                        var finish = function() {\n\t\t\t\t\t\t\t$rootScope.controllers = sites;\n                            Utils.storage.set( { \"controllers\": JSON.stringify( sites ) }, saveSites );\n                            Utils.updateQuickLinks();\n                        };\n\n                        // Handle how to merge when cloud is populated\n                        $ionicActionSheet.show( {\n                            buttons: [\n                                { text: \"<i class='icon ion-merge'></i> Merge\" },\n                                { text: \"<i class='icon ion-ios-cloud-download'></i> Replace local with cloud\" },\n                                { text: \"<i class='icon ion-ios-cloud-upload'></i> Replace cloud with local\" }\n                            ],\n                            titleText: \"Select Merge Method\",\n                            cancelText: \"Cancel\",\n                            buttonClicked: function( index ) {\n                                if ( index === 1 ) {\n\n                                    // Replace local with cloud\n                                    finish();\n                                } else if ( index === 2 ) {\n\n                                    // Replace cloud with local\n                                    sites = $rootScope.controllers;\n                                    finish();\n                                } else {\n\t\t\t\t\t\t\t\t\t$filter = $filter || $injector.get( \"$filter\" );\n\n                                    // Merge data\n                                    sites = $filter( \"unique\" )( $rootScope.controllers.concat( sites ), \"mac\" );\n                                    finish();\n                                }\n                                return true;\n                            }\n                        } );\n                    } else {\n                        saveSites();\n                    }\n                } );\n            },\n            sync = function( callback ) {\n                callback = callback || function() {};\n\n                Utils.storage.get( \"cloudToken\", function( local ) {\n                    if ( typeof local.cloudToken !== \"string\" ) {\n                        return;\n                    }\n\n                    getSites( function( data ) {\n                        if ( data !== false ) {\n                            $rootScope.controllers = data;\n                            Utils.storage.set( { \"controllers\": JSON.stringify( data ) }, callback );\n                            Utils.updateQuickLinks();\n                        }\n                    } );\n                } );\n            },\n            getSites = function( callback ) {\n                callback = callback || function() {};\n                $http = $http || $injector.get( \"$http\" );\n                $httpParamSerializerJQLike = $httpParamSerializerJQLike || $injector.get( \"$httpParamSerializerJQLike\" );\n\n                Utils.storage.get( [ \"cloudToken\", \"cloudDataToken\" ], function( local ) {\n                    if ( local.cloudToken === undefined || local.cloudToken === null ) {\n                        callback( false );\n                        return;\n                    }\n\n                    if ( local.cloudDataToken === undefined || local.cloudDataToken === null ) {\n                        handleInvalidDataToken( function( success ) {\n                            if ( success ) {\n                                getSites( callback );\n                            } else {\n                                callback( false );\n                            }\n                        } );\n                        return;\n                    }\n\n                    $http( {\n                        method: \"POST\",\n                        url: \"https://opengarage.io/wp-admin/admin-ajax.php\",\n\t\t\t\t\t\theaders: {\n\t\t\t\t\t\t\t\"Content-Type\": \"application/x-www-form-urlencoded; charset=UTF-8\"\n\t\t\t\t\t\t},\n                        data: $httpParamSerializerJQLike( {\n                            action: \"getSites\",\n                            token: local.cloudToken,\n                            controllerType: \"opengarage\"\n                        } )\n                    } ).then( function( result ) {\n                        if ( result.data.success === false || result.data.sites === \"\" ) {\n                            if ( result.data.message === \"BAD_TOKEN\" ) {\n                                handleExpiredLogin();\n                            }\n                            callback( false, result.data.message );\n                        } else {\n                            Utils.storage.set( { \"cloudToken\": result.data.token } );\n                            var sites;\n\n                            try {\n                                sites = sjcl.decrypt( local.cloudDataToken, result.data.sites );\n                            } catch ( err ) {\n                                if ( err.message === \"ccm: tag doesn't match\" ) {\n                                    handleInvalidDataToken( function( success ) {\n                                        if ( success ) {\n                                            getSites( callback );\n                                        } else {\n                                            callback( false );\n                                        }\n                                    } );\n                                }\n                            }\n\n                            try {\n                                callback( JSON.parse( sites ) );\n                            } catch ( err ) {\n                                callback( false );\n                            }\n                        }\n                    }, function() {\n                        callback( false );\n                    } );\n                } );\n            },\n            saveSites = function( callback ) {\n\t\t\t\tif ( typeof callback !== \"function\" ) {\n\t                callback = function() {};\n\t\t\t\t}\n                $http = $http || $injector.get( \"$http\" );\n                $httpParamSerializerJQLike = $httpParamSerializerJQLike || $injector.get( \"$httpParamSerializerJQLike\" );\n\n                Utils.storage.get( [ \"cloudToken\", \"cloudDataToken\" ], function( data ) {\n                    if ( data.cloudToken === null || data.cloudToken === undefined ) {\n                        callback( false );\n                        return;\n                    }\n\n                    $http( {\n                        method: \"POST\",\n                        url: \"https://opengarage.io/wp-admin/admin-ajax.php\",\n\t\t\t\t\t\theaders: {\n\t\t\t\t\t\t\t\"Content-Type\": \"application/x-www-form-urlencoded; charset=UTF-8\"\n\t\t\t\t\t\t},\n                        suppressLoader: true,\n                        data: $httpParamSerializerJQLike( {\n                            action: \"saveSites\",\n                            token: data.cloudToken,\n                            controllerType: \"opengarage\",\n                            sites: encodeURIComponent( JSON.stringify( sjcl.encrypt( data.cloudDataToken, JSON.stringify( $rootScope.controllers ) ) ) )\n                        } )\n                    } ).then( function( result ) {\n                        if ( result.data.success === false ) {\n                            if ( result.data.message === \"BAD_TOKEN\" ) {\n                                handleExpiredLogin();\n                            }\n                            callback( false, result.data.message );\n                        } else {\n                            Utils.storage.set( { \"cloudToken\": result.data.token } );\n                            callback( result.data.success );\n                        }\n                    }, function() {\n                        callback( false );\n                    } );\n                } );\n            },\n            handleInvalidDataToken = function( callback ) {\n\t\t\t\tif ( typeof callback !== \"function\" ) {\n\t                callback = function() {};\n\t\t\t\t}\n                Utils.storage.remove( \"cloudDataToken\" );\n\n                $ionicPopup = $ionicPopup || $injector.get( \"$ionicPopup\" );\n                $ionicPopup.prompt( {\n                    title: \"Unable to read cloud data\",\n                    subTitle: \"Enter a valid password to decrypt the data\",\n                    template: \"Please enter your OpenSprinkler.com password. If you have recently changed your password, you may need to enter your previous password to decrypt the data.\",\n                    inputType: \"password\",\n                    inputPlaceholder: \"Password\"\n                } ).then(\n                    function( password ) {\n                        Utils.storage.set( {\n                            \"cloudDataToken\": sjcl.codec.hex.fromBits( sjcl.hash.sha256.hash( password ) )\n                        } );\n                        callback( true );\n                    },\n                    function() {\n                        callback( false );\n                    }\n                );\n            },\n            handleExpiredLogin = function() {\n                Utils.storage.remove( \"cloudToken\" );\n\n                $ionicPopup = $ionicPopup || $injector.get( \"$ionicPopup\" );\n                $ionicPopup.confirm( {\n                    title: \"OpenGarage.io Login Expired\",\n                    template: \"Click here to re-login to OpenGarage.io\"\n                } ).then( function( result ) {\n                    if ( result ) {\n\n                        requestAuth( function( result ) {\n                            if ( result === true ) {\n                                sync();\n                            }\n                        } );\n\n                    }\n                } );\n            },\n            getTokenUser = function( token ) {\n                return atob( token ).split( \"|\" )[ 0 ];\n            },\n            $http, $httpParamSerializerJQLike, $filter, $ionicPopup, $ionicActionSheet;\n\n        Utils.storage.get( [ \"cloudToken\", \"cloudDataToken\" ], function( data ) {\n\t\t\tif ( data.cloudToken === null || data.cloudToken === undefined || data.cloudDataToken === undefined || data.cloudDataToken === undefined ) {\n\t\t\t\t$rootScope.isSynced = false;\n\t\t\t} else {\n\t\t\t\t$rootScope.isSynced = true;\n\t\t\t}\n        } );\n\n        $rootScope.$on( \"controllersUpdated\", saveSites );\n\n        return {\n            requestAuth: requestAuth,\n            login: login,\n            logout: logout,\n            syncStart: syncStart,\n            sync: sync,\n            getSites: getSites,\n            saveSites: saveSites,\n            handleInvalidDataToken: handleInvalidDataToken,\n            handleExpiredLogin: handleExpiredLogin,\n            getTokenUser: getTokenUser\n        };\n    } ] );\n\n/* global angular, ionic */\n\nangular.module( \"opengarage.controllers\", [ \"opengarage.utils\", \"opengarage.cloud\" ] )\n\n\t.controller( \"LoginCtrl\", function( $scope, $state, $ionicPopup, Cloud ) {\n\t\t$scope.data = {};\n\n\t\t$scope.submit = function() {\n\t\t\tif ( !$scope.data.username ) {\n\n\t\t\t\t// If no email is provided, throw an error\n\t\t\t\t$ionicPopup.alert( {\n\t\t\t\t\ttemplate: \"<p class='center'>Please enter a username to continue.</p>\"\n\t\t\t\t} );\n\t\t\t} else if ( !$scope.data.password ) {\n\n\t\t\t\t// If no password is provided, throw an error\n\t\t\t\t$ionicPopup.alert( {\n\t\t\t\t\ttemplate: \"<p class='center'>Please enter a password to continue.</p>\"\n\t\t\t\t} );\n\t\t\t} else {\n\t\t\t\tCloud.login( $scope.data.username, $scope.data.password, function() {\n\t\t\t\t\tCloud.sync( function() {\n\t\t\t\t\t\t$state.go( \"app.controllerSelect\" );\n\t\t\t\t\t} );\n\t\t\t\t} );\n\t\t\t}\n\t\t};\n\n\t\t$scope.skipCloud = function() {\n\t\t\t$state.go( \"app.controllerSelect\" );\n\t\t};\n\t} )\n\n\t.controller( \"ControllerSelectCtrl\", function( $scope, $state, $rootScope, $ionicHistory, Utils, Cloud ) {\n\t\t$scope.data = {\n\t\t\tshowDelete: false\n\t\t};\n\n\t\t$scope.selectPhoto = Utils.selectPhoto;\n\n\t\t$scope.setController = function( index ) {\n\t\t\tUtils.setController( index );\n\n\t\t\t$ionicHistory.nextViewOptions( {\n\t\t\t\thistoryRoot: true\n\t\t\t} );\n\n\t\t\t$state.go( \"app.home\" );\n\t\t};\n\n\t\t$scope.deleteController = function( index ) {\n\t\t\tif ( Utils.getControllerIndex() === index ) {\n\t\t\t\tdelete $rootScope.activeController;\n\t\t\t\tUtils.storage.remove( \"activeController\" );\n\t\t\t}\n\n\t\t\t$rootScope.controllers.splice( index, 1 );\n\t\t\tUtils.storage.set( { controllers: JSON.stringify( $rootScope.controllers ) } );\n\t\t\t$rootScope.$broadcast( \"controllersUpdated\" );\n\t\t};\n\n\t\t$scope.moveItem = function( item, fromIndex, toIndex ) {\n\t\t\t$rootScope.controllers.splice( fromIndex, 1 );\n\t\t\t$rootScope.controllers.splice( toIndex, 0, item );\n\t\t\tUtils.storage.set( { controllers: JSON.stringify( $rootScope.controllers ) } );\n\t\t\t$rootScope.$broadcast( \"controllersUpdated\" );\n\t\t};\n\n\t\t$scope.getTime = function( timestamp ) {\n\t\t\treturn new Date( timestamp ).toLocaleString();\n\t\t};\n\n\t\t$scope.changeSync = function() {\n\t\t\tif ( $rootScope.isSynced ) {\n\t\t\t\tCloud.logout();\n\t\t\t} else {\n\t\t\t\tCloud.requestAuth();\n\t\t\t}\n\t\t};\n\t} )\n\n\t.controller( \"HistoryCtrl\", function( $scope, Utils ) {\n        $scope.isLocal = true;\n\n\t\t$scope.$on( \"$ionicView.beforeEnter\", function() {\n\t\t\tUtils.getLogs( function( reply ) {\n\t\t\t\tif ( reply ) {\n\t\t\t\t\tvar i, current, day;\n\n\t\t\t\t\tfor ( i = 0; i < reply.length; i++ ) {\n\t\t\t\t\t\tcurrent = new Date( reply[ i ][ 0 ] * 1000 ).toDateString();\n\n\t\t\t\t\t\tif ( current !== day ) {\n\t\t\t\t\t\t\tday = current;\n\t\t\t\t\t\t\treply.splice( i, 0, { isDivider: \"true\", day: current } );\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\t$scope.logs = reply;\n\t\t\t\t} else {\n\t\t\t\t\t$scope.isLocal = false;\n\t\t\t\t}\n\t\t\t} );\n\t\t} );\n\t} )\n\n\t.controller( \"SettingsCtrl\", function( $scope, $state, $ionicPopup, Utils ) {\n\t\t$scope.settings = {};\n        $scope.isLocal = true;\n\n\t\t$scope.changePassword = Utils.changePassword;\n\t\t$scope.restart = Utils.restartController;\n\n\t\t$scope.submit = function() {\n\t\t\tUtils.saveOptions( $scope.settings, function( reply ) {\n\t\t\t\tvar text;\n\n\t\t\t\tif ( reply ) {\n\t\t\t\t\ttext = \"Settings saved successfully!\";\n\t\t\t\t\t$state.go( \"app.home\" );\n\t\t\t\t} else {\n\t\t\t\t\ttext = \"Unable to save settings. Please check the connection to the device and try again.\";\n\t\t\t\t}\n\t\t\t\t$ionicPopup.alert( {\n\t\t\t\t\ttemplate: \"<p class='center'>\" + text + \"</p>\"\n\t\t\t\t} );\n\t\t\t} );\n\t\t};\n\n\t\t$scope.$on( \"$ionicView.beforeEnter\", function() {\n\t\t\tUtils.getControllerOptions( function( reply ) {\n\t\t\t\tif ( reply ) {\n\n\t\t\t\t\t// Remove unused options to prevent accidental change\n\t\t\t\t\tdelete reply.mod;\n\t\t\t\t\tdelete reply.fwv;\n\t\t\t\t\t$scope.settings = reply;\n\t\t\t\t} else {\n\t\t\t\t\t$scope.isLocal = false;\n\t\t\t\t}\n\t\t\t}, null, null, true );\n\t\t} );\n\t} )\n\n\t.controller( \"MenuCtrl\", function( $scope, $rootScope, $ionicActionSheet, $ionicPopup, $ionicSideMenuDelegate, Utils ) {\n\n\t\t$scope.sideMenuDraggable = Utils.getControllerIndex() === 0 ? true : false;\n\n\t\t$rootScope.$on( \"controllerUpdated\", function() {\n\t\t\t$scope.sideMenuDraggable = Utils.getControllerIndex() === 0 ? true : false;\n\t\t} );\n\n\t\t$scope.showAddController = function() {\n\t\t\t$ionicActionSheet.show( {\n\t\t\t\tbuttons: [\n\t\t\t\t\t{ text: \"<i class='icon ion-plus-circled'></i> Add by IP\" },\n\t\t\t\t\t{ text: \"<i class='icon ion-network'></i> Add by Blynk Token\" },\n\t\t\t\t\t{ text: \"<i class='icon ion-network'></i> Add by OpenThings Cloud Token\" },\n\t\t\t\t\t{ text: \"<i class='icon ion-ios-color-wand'></i> Setup New Device\" }\n\t\t\t\t],\n\t\t\t\ttitleText: \"Add Controller\",\n\t\t\t\tcancelText: \"Cancel\",\n\t\t\t\tbuttonClicked: function( index ) {\n\t\t\t\t\tif ( index === 0 ) {\n\t\t\t\t\t\tUtils.showAddController();\n\t\t\t\t\t} else if ( index === 1 ) {\n\t\t\t\t\t\tUtils.showAddBlynk();\n                    } else if ( index === 2 ) {\n                        Utils.showAddOtc();\n\t\t\t\t\t} else {\n\t\t\t\t\t\tUtils.checkNewController( function( result ) {\n\t\t\t\t\t\t\tif ( !result ) {\n\t\t\t\t\t\t\t\t$ionicPopup.alert( {\n\t\t\t\t\t\t\t\t\ttemplate: \"<p class='center'>Please first connect the power to your OpenGarage. Once complete, connect this device to the wifi network broadcast by the OpenGarage (named OG_XXXXXX) and reopen this app.</p>\"\n\t\t\t\t\t\t\t\t} );\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}, false );\n\t\t\t\t\t}\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t} );\n\t\t};\n\n\t\t// Function to close the menu which is fired after a side menu link is clicked.\n\t\t// This is done instead of using the menu-close directive to preserve the root history stack\n\t    $scope.closeMenu = function() {\n            $ionicSideMenuDelegate.toggleLeft( false );\n\t    };\n\t} )\n\n\t.controller( \"HomeCtrl\", function( $rootScope, $scope, $timeout, Utils ) {\n        var interval;\n\n\t\t$scope.toggleDoor = Utils.toggleDoor;\n\t\t$scope.selectPhoto = Utils.selectPhoto;\n\t\t$scope.currentIndex = Utils.getControllerIndex();\n\n\t\t$scope.changeController = function( direction ) {\n\t\t\tvar current = Utils.getControllerIndex(),\n\t\t\t\tto = current + direction;\n\n\t\t\tif ( current === -1 || to < 0 || to >= $rootScope.controllers.length ) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t$scope.currentIndex = to;\n\t\t\tUtils.setController( to );\n\t\t};\n\n\t\t$scope.$on( \"$ionicView.beforeLeave\", function() {\n\t\t\tclearInterval( interval );\n\t\t} );\n\n\t\t$scope.$on( \"$ionicView.beforeEnter\", function() {\n            interval = setInterval( Utils.updateController, 5000 );\n        } );\n\n\t\t$rootScope.$on( \"controllerUpdated\", function() {\n\t\t\t$scope.currentIndex = Utils.getControllerIndex();\n\t\t\t$timeout( function() {\n\t\t\t\t$scope.$apply();\n\t\t\t} );\n\t\t} );\n\t} )\n\n\t.controller( \"RulesCtrl\", function( $scope, $rootScope ) {\n\t\tvar reset = function() {\n\t\t\t$scope.geo = {\n\t\t\t\thome: { direction: \"open\" },\n\t\t\t\taway: { direction: \"close\" }\n\t\t\t};\n\t\t\t$scope.set( \"home\" );\n\t\t};\n\n\t\t$scope.isAndroid = ionic.Platform.isAndroid();\n\n\t\t$scope.set = function( type ) {\n\t\t\tif ( type === \"home\" ) {\n\t\t\t\t$scope.current = $scope.geo.home;\n\t\t\t} else {\n\t\t\t\t$scope.current = $scope.geo.away;\n\t\t\t}\n\t\t};\n\n\t\t$rootScope.$on( \"controllerUpdated\", reset );\n\t\treset();\n\t} );\n\n/* global angular, window */\n\n// TODO make this configurable.\nvar OPENTHINGS_CLOUD_HOST = \"https://cloud.openthings.io\";\n\n// OpenGarage\nangular.module( \"opengarage.utils\", [] )\n    .factory( \"Utils\", [ \"$injector\", \"$rootScope\", function( $injector, $rootScope ) {\n\n\t\tvar isFireFox = /Firefox/.test( window.navigator.userAgent ),\n\t\t\tisIE = /MSIE\\s|Trident\\/|Edge\\//.test( window.navigator.userAgent ),\n\n\t        // Define storage wrapper functions\n\t        storage = {\n\t            get: function( query, callback ) {\n\t                callback = callback || function() {};\n\n                    var data = {},\n                        i;\n\n                    if ( typeof query === \"string\" ) {\n                        query = [ query ];\n                    }\n\n                    for ( i in query ) {\n                        if ( query.hasOwnProperty( i ) ) {\n                            data[ query[ i ] ] = localStorage.getItem( query[ i ] );\n                        }\n                    }\n\n                    callback( data );\n\t            },\n\t            set: function( query, callback ) {\n\t                callback = callback || function() {};\n\n                    var i;\n                    if ( typeof query === \"object\" ) {\n                        for ( i in query ) {\n                            if ( query.hasOwnProperty( i ) ) {\n                                localStorage.setItem( i, query[ i ] );\n                            }\n                        }\n                    }\n\n                    callback( true );\n\t            },\n\t            remove: function( query, callback ) {\n\t                callback = callback || function() {};\n\n                    var i;\n\n                    if ( typeof query === \"string\" ) {\n                        query = [ query ];\n                    }\n\n                    for ( i in query ) {\n                        if ( query.hasOwnProperty( i ) ) {\n                            localStorage.removeItem( query[ i ] );\n                        }\n                    }\n\n                    callback( true );\n\t            }\n\t        },\n\t\t\tintToIP = function( int ) {\n\t\t\t\treturn ( int % 256 ) + \".\" + ( ( int / 256 >> 0 ) % 256 ) + \".\" + ( ( ( int / 256 >> 0 ) / 256 >> 0 ) % 256 ) + \".\" + ( ( ( int / 256 >> 0 ) / 256 >> 0 ) / 256 >> 0 );\n\t\t\t},\n\t        getControllerSettings = function( callback, ip, token, blynkServer ) {\n\t\t\t\tif ( !ip && !token && !$rootScope.activeController ) {\n\t\t\t\t\tcallback( false );\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n                $q = $q || $injector.get( \"$q\" );\n\t\t\t\t$http = $http || $injector.get( \"$http\" );\n\n\t\t\t\tvar promise;\n\n\t\t\t\tif ( ( token && !isOTCToken( token ) ) || ( !ip && ( $rootScope.activeController && $rootScope.activeController.auth && !isOTCToken( $rootScope.activeController.auth ) ) ) ) {\n                    if ( !blynkServer ) {\n                        if ( !$rootScope.activeController.bdmn ) {\n                            blynkServer = \"blynk-cloud.com\";\n                        } else {\n                            blynkServer = $rootScope.activeController.bdmn;\n                        }\n\n                        if ( $rootScope.activeController.bprt ) {\n                            blynkServer += \":\" + $rootScope.activeController.bprt;\n                        }\n                    }\n\n                    promise = $q.all( {\n                        name: $http( {\n                            method: \"POST\",\n                            url: \"https://opengarage.io/wp-admin/admin-ajax.php\",\n                            headers: { \"Content-Type\": \"application/x-www-form-urlencoded; charset=UTF-8\" },\n                            data: \"action=blynkCloud&server=\" + encodeURIComponent( blynkServer ) + \"&path=\" + encodeURIComponent( token || $rootScope.activeController.auth ) + \"/project\",\n                            suppressLoader: true\n                        } ),\n                        door: $http( {\n                            method: \"POST\",\n                            url: \"https://opengarage.io/wp-admin/admin-ajax.php\",\n                            headers: { \"Content-Type\": \"application/x-www-form-urlencoded; charset=UTF-8\" },\n                            data: \"action=blynkCloud&server=\" + encodeURIComponent( blynkServer ) + \"&path=\" + encodeURIComponent( token || $rootScope.activeController.auth ) + \"/get/V0\",\n                            suppressLoader: true\n                        } ),\n                        vehicle: $http( {\n                            method: \"POST\",\n                            url: \"https://opengarage.io/wp-admin/admin-ajax.php\",\n                            headers: { \"Content-Type\": \"application/x-www-form-urlencoded; charset=UTF-8\" },\n                            data: \"action=blynkCloud&server=\" + encodeURIComponent( blynkServer ) + \"&path=\" + encodeURIComponent( token || $rootScope.activeController.auth ) + \"/get/V4\",\n                            suppressLoader: true\n                        } )\n                    } );\n\t\t\t\t} else {\n\t\t\t\t\tpromise = $http( {\n\t\t\t\t\t\tmethod: \"GET\",\n\t\t\t\t\t\turl: getBaseUrl( ip, token ) + \"/jc\",\n\t\t\t\t\t\tsuppressLoader: ip ? false : true\n\t\t\t\t\t} );\n\t\t\t\t}\n\n\t            return promise.then(\n\t\t\t\t\tfunction( result ) {\n\t\t\t\t\t\tif ( ( token && !isOTCToken( token ) ) || ( !ip && ( $rootScope.activeController && $rootScope.activeController.auth && !isOTCToken( $rootScope.activeController.auth ) ) ) ) {\n\t\t\t\t\t\t\tif ( result.name.data === \"Invalid token.\" ) {\n\t\t\t\t\t\t\t\tcallback( false );\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tcallback( {\n\t\t\t\t\t\t\t\tname: result.name.data.name,\n\t\t\t\t\t\t\t\tdoor: parseInt( result.door.data[ 0 ] ) === 255 ? 1 : 0,\n                                lastUpdate: result.name.data.updatedAt,\n                                vehicle: parseInt( result.vehicle.data[ 0 ] ) === 255 ? 1 : 0\n\t\t\t\t\t\t\t} );\n\t\t\t\t\t\t} else {\n                            if ( result.status !== 200 ) {\n                                callback( false );\n                                return;\n                            }\n\n                            result.data.lastUpdate = new Date().getTime();\n\t\t\t\t\t\t\tcallback( result.data );\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\tfunction() {\n\t\t\t\t\t\tcallback( false );\n\t\t\t\t\t}\n\t\t\t\t);\n\t        },\n\t        getControllerOptions = function( callback, ip, token, showLoader ) {\n\t\t\t\tif ( ( !ip && !token && !$rootScope.activeController ) || ( $rootScope.activeController && !$rootScope.activeController.ip && !isOTCToken( $rootScope.activeController.auth ) ) ) {\n\t\t\t\t\tcallback( false );\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\t$http = $http || $injector.get( \"$http\" );\n\n\t            return $http( {\n\t                method: \"GET\",\n\t                url: getBaseUrl( ip, token ) + \"/jo\",\n                    suppressLoader: showLoader ? false : true\n\t            } ).then(\n\t\t\t\t\tfunction( result ) {\n\t\t\t\t\t\tcallback( result.data );\n\t\t\t\t\t},\n\t\t\t\t\tfunction() {\n\t\t\t\t\t\tcallback( false );\n\t\t\t\t\t}\n\t\t\t\t);\n\t        },\n\t        updateController = function() {\n\t\t\t\tvar controller = angular.copy( $rootScope.activeController ) || {};\n\n\t\t\t\treturn getControllerSettings( function( data ) {\n                    if ( data === false ) {\n                        $rootScope.connected = false;\n                        return;\n                    }\n\n                    $rootScope.connected = true;\n                    angular.extend( controller, data );\n                } ).then( function() {\n                    var index = getControllerIndex();\n\n                    if ( index >= 0 && controller.mac === $rootScope.activeController.mac ) {\n                        $rootScope.controllers[ index ] = controller;\n                        $rootScope.activeController = controller;\n                        $rootScope.$broadcast( \"controllerUpdated\" );\n                        $rootScope.$broadcast( \"controllersUpdated\" );\n                        storage.set( { \"controllers\": JSON.stringify( $rootScope.controllers ), \"activeController\": JSON.stringify( $rootScope.activeController ) } );\n                    }\n                } );\n\t        },\n\t        getControllerIndex = function( mac ) {\n\t\t\t\tif ( !$rootScope.activeController && !mac ) {\n\t\t\t\t\treturn null;\n\t\t\t\t}\n\n\t\t\t\tmac = mac || ( $rootScope.activeController === null ? \"\" : $rootScope.activeController.mac );\n\n\t\t\t\tfor ( var i = 0; i < $rootScope.controllers.length; i++ ) {\n\t\t\t\t\tif ( $rootScope.controllers[ i ].mac === mac ) {\n\t\t\t\t\t\treturn i;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn null;\n\t        },\n\t        setController = function( controller, callback ) {\n\t\t\t\tcallback = callback || function() {};\n\n\t\t\t\tcancelPendingHttp();\n\t\t\t\t$rootScope.activeController = typeof controller === \"object\" ? controller : $rootScope.controllers[ controller ];\n\t\t\t\t$rootScope.connected = false;\n\t\t\t\tupdateController();\n\t\t\t\tstorage.set( { activeController: JSON.stringify( $rootScope.activeController ) }, callback );\n\t\t\t\tupdateQuickLinks();\n\t        },\n\t\t\taddController = function( data, callback ) {\n\t\t\t\tcallback = callback || function() {};\n\t\t\t\t$ionicPopup = $ionicPopup || $injector.get( \"$ionicPopup\" );\n\n\t\t\t\tif ( !data.token && ( !data.ip || !data.password ) ) {\n\t\t\t\t\t$ionicPopup.alert( {\n\t\t\t\t\t\ttemplate: \"<p class='center'>Both an IP and password are required.</p>\"\n\t\t\t\t\t} );\n\t\t\t\t\tcallback( false );\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif ( data.token && data.token.length !== 32 ) {\n\t\t\t\t\t$ionicPopup.alert( {\n\t\t\t\t\t\ttemplate: \"<p class='center'>A valid \" + ( isOTCToken( data.token ) ? \"OpenThings Cloud\" : \"Blynk\" ) + \" token is required. Please verify your token and try again.</p>\"\n\t\t\t\t\t} );\n\t\t\t\t\tcallback( false );\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tgetControllerSettings( function( result ) {\n\t\t\t\t\tif ( !result ) {\n\t\t\t\t\t\t$ionicPopup.alert( {\n\t\t\t\t\t\t\ttemplate: \"<p class='center'>Unable to find device. Please verify the IP/password and try again.</p>\"\n\t\t\t\t\t\t} );\n\t\t\t\t\t\tcallback( false );\n\t\t\t\t\t}\n\n                    $filter = $filter || $injector.get( \"$filter\" );\n\n\t\t\t\t\tif ( result.mac ) {\n\t\t\t\t\t\tresult.ip = data.ip;\n                        result.auth = data.token;\n\t\t\t\t\t\tresult.password = data.password;\n\n\t\t\t\t\t\tif ( $filter( \"filter\" )( $rootScope.controllers, { \"mac\": result.mac } ).length > 0 ) {\n\t\t\t\t\t\t\t$ionicPopup.alert( {\n\t\t\t\t\t\t\t\ttemplate: \"<p class='center'>Device already added to site list.</p>\"\n\t\t\t\t\t\t\t} );\n\t\t\t\t\t\t\tcallback( false );\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tgetControllerOptions(\n                            function( reply ) {\n                                angular.extend( result, reply );\n                                $rootScope.controllers.push( result );\n                                storage.set( { controllers: JSON.stringify( $rootScope.controllers ) } );\n                                $rootScope.$broadcast( \"controllersUpdated\" );\n                                callback( true );\n                            },\n                            data.token ? null : data.ip,\n                            data.token ? data.token : null\n                        );\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( data.token && !isOTCToken( data.token ) ) {\n                        result.auth = data.token;\n                        result.bdmn = data.bdmn;\n                        result.bprt = data.bprt;\n\n                        $rootScope.controllers.push( result );\n                        storage.set( { controllers: JSON.stringify( $rootScope.controllers ) } );\n                        $rootScope.$broadcast( \"controllersUpdated\" );\n                        callback( true );\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tdata.token ? null : data.ip,\n\t\t\t\tdata.token ? data.token : null,\n                data.bdmn && data.bprt ? data.bdmn + \":\" + data.bprt : null\n\t\t\t\t);\n\t\t\t},\n\t\t\tcheckNewController = function( callback, suppressLoader ) {\n\t\t\t\t$http = $http || $injector.get( \"$http\" );\n\t\t\t\tcallback = callback || function() {};\n\t\t\t\t$ionicModal = $ionicModal || $injector.get( \"$ionicModal\" );\n\n\t            $http( {\n\t                method: \"GET\",\n\t                url: \"http://192.168.4.1/js\",\n\t                suppressLoader: typeof suppressLoader !== \"undefined\" ? suppressLoader : true,\n\t\t\t\t\ttimeout: 5000,\n\t\t\t\t\tretryCount: 3\n\t            } ).then(\n\t\t\t\t\tfunction( result ) {\n\t\t\t\t\t\tif ( !result.data.ssids ) {\n\t\t\t\t\t\t\tcallback( false );\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tvar scope = $rootScope.$new();\n\t\t\t\t\t\tscope.data = {};\n\t\t\t\t\t\tscope.save = function() {\n\t\t\t\t\t\t\tscope.modal.hide();\n\t\t\t\t\t\t\tconnectNewController( scope.data );\n\t\t\t\t\t\t};\n\t\t\t\t\t\tscope.ssids = result.data.ssids;\n\t\t\t\t\t\t$ionicModal.fromTemplateUrl( \"templates/newControllerSetup.html\", {\n\t\t\t\t\t\t\tscope: scope,\n\t\t\t\t\t\t\tanimation: \"slide-in-up\"\n\t\t\t\t\t\t} ).then( function( modal ) {\n\t\t\t\t\t\t\tscope.modal = modal;\n\t\t\t\t\t\t\tmodal.show();\n\t\t\t\t\t\t} );\n\t\t\t\t\t\tcallback( true );\n\t\t\t\t\t},\n\t\t\t\t\tfunction() {\n\t\t\t\t\t\tcallback( false );\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t},\n\t\t\tconnectNewController = function( data ) {\n\t\t\t\t$http = $http || $injector.get( \"$http\" );\n\t\t\t\t$ionicPopup = $ionicPopup || $injector.get( \"$ionicPopup\" );\n\n\t            $http( {\n\t                method: \"GET\",\n\t                url: \"http://192.168.4.1/cc?ssid=\" + encodeURIComponent( data.ssid ) + \"&pass=\" + encodeURIComponent( data.password )\n\t            } ).then(\n\t\t\t\t\tfunction( result ) {\n\t\t\t\t\t\tif ( result.data.result === 1 ) {\n\t\t\t\t\t\t\tsetTimeout( saveNewController, 2000 );\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t$ionicPopup.alert( {\n\t\t\t\t\t\t\t\ttemplate: \"<p class='center'>Invalid SSID/password combination. Please try again.</p>\"\n\t\t\t\t\t\t\t} ).then( checkNewController );\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\tfunction() {\n\t\t\t\t\t\t$ionicPopup.alert( {\n\t\t\t\t\t\t\ttemplate: \"<p class='center'>Unable to reach controller. Please try again.</p>\"\n\t\t\t\t\t\t} ).then( checkNewController );\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t},\n\t\t\tsaveNewController = function() {\n\t\t\t\t$http = $http || $injector.get( \"$http\" );\n\t\t\t\t$ionicPopup = $ionicPopup || $injector.get( \"$ionicPopup\" );\n\n\t            $http( {\n\t                method: \"GET\",\n\t                url: \"http://192.168.4.1/jt\"\n\t            } ).then( function( result ) {\n\t\t\t\t\tif ( result.data.ip === 0 ) {\n\t\t\t\t\t\t$ionicPopup.alert( {\n\t\t\t\t\t\t\ttemplate: \"<p class='center'>Controller was unable to connect. Please check your SSID and password and try again.</p>\"\n\t\t\t\t\t\t} );\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\t$ionicPopup.alert( {\n\t\t\t\t\t\ttemplate: \"<p class='center'>Controller succesfully connected! Please wait while the device reboots.</p>\"\n\t\t\t\t\t} );\n\n\t\t\t\t\t$rootScope.controllers.push( {\n\t\t\t\t\t\tip: intToIP( result.data.ip ),\n\t\t\t\t\t\tpassword: \"opendoor\",\n\t\t\t\t\t\tname: \"My OpenGarage\"\n\t\t\t\t\t} );\n\t\t\t\t\tstorage.set( { controllers: JSON.stringify( $rootScope.controllers ) } );\n\t\t\t\t\t$rootScope.$broadcast( \"controllersUpdated\" );\n\t\t\t\t} );\n\t\t\t},\n\t\t\tscanLocalNetwork = function( callback ) {\n\t\t\t\tif ( !window.networkinterface ) {\n\t\t\t\t\tcallback( false );\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\twindow.networkinterface.getWiFiIPAddress(\n                    function( address ) {\n                        if ( !address ) {\n                            callback( false );\n                            return;\n                        }\n\n                        $q = $q || $injector.get( \"$q\" );\n                        $http = $http || $injector.get( \"$http\" );\n                        var router = address.ip.split( \".\" );\n                        router.pop();\n\n                        var baseip = router.join( \".\" ),\n                            check = function( ip ) {\n                                return $http( {\n                                        method: \"GET\",\n                                        url: \"http://\" + baseip + \".\" + ip + \"/jc\",\n                                        suppressLoader: true,\n                                        timeout: 6000,\n                                        retryCount: 3\n                                    } )\n                                    .then( function( result ) {\n                                        if ( result.data && result.data.mac ) {\n                                            matches.push( baseip + \".\" + ip );\n                                        }\n                                    } )\n                                    .catch( function() {\n                                        return false;\n                                    } );\n                            },\n                            queue = [], matches = [], i;\n\n                        $rootScope.$broadcast( \"loading:show\" );\n\n                        for ( i = 1; i <= 244; i++ ) {\n                            queue.push( check( i ) );\n                        }\n\n                        $q.all( queue ).then( function() {\n                            $rootScope.$broadcast( \"loading:hide\" );\n                            callback( matches );\n                        } );\n                    },\n                    function() {\n                        callback( false );\n                    }\n                );\n\t\t\t},\n\t\t\trequestPassword = function( callback ) {\n\t\t\t\t$ionicPopup = $ionicPopup || $injector.get( \"$ionicPopup\" );\n\n\t\t\t\t$ionicPopup.prompt( {\n\t\t\t\t\ttitle: \"Enter Controller Password\",\n\t\t\t\t\ttemplate: \"Enter your controller's password below:\",\n\t\t\t\t\tinputType: \"password\",\n\t\t\t\t\tinputPlaceholder: \"Controller Password\"\n\t\t\t\t} ).then( function( password ) {\n\t\t\t\t\tcallback( password );\n\t\t\t\t} );\n\t\t\t},\n\t\t\tupdateQuickLinks = function() {\n\t\t\t\tif ( !window.ThreeDeeTouch ) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\twindow.ThreeDeeTouch.isAvailable( function( isAvailable ) {\n\t\t\t\t\tif ( !isAvailable || !$rootScope.controllers.length ) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tvar links = [],\n\t\t\t\t\t\tlimit = $rootScope.controllers.length < 4 ? $rootScope.controllers.length : 4;\n\n\t\t\t\t\tfor ( var i = 0; i < limit; i++ ) {\n\t\t\t\t\t\tlinks.push( {\n\t\t\t\t\t\t\ttype: \"toggle-\" + $rootScope.controllers[ i ].mac,\n\t\t\t\t\t\t\ttitle: \"Toggle \" + $rootScope.controllers[ i ].name,\n\t\t\t\t\t\t\ticonType: \"Update\"\n\t\t\t\t\t\t} );\n\t\t\t\t\t}\n\n\t\t\t\t\twindow.ThreeDeeTouch.configureQuickActions( links );\n\t\t\t\t} );\n\t\t\t},\n\t\t\tcancelPendingHttp = function() {\n\t\t\t\t$http = $http || $injector.get( \"$http\" );\n\n\t\t\t\t$http.pendingRequests.forEach( function( pendingReq ) {\n\t\t\t\t\tif ( pendingReq.cancel ) {\n\t\t\t\t\t\tpendingReq.cancel.resolve();\n\t\t\t\t\t}\n\t\t\t\t} );\n\t\t\t},\n            /**\n             * Returns the URL that requests to a controller should be relative to. If neither an IP address nor an\n             * OpenThings Cloud token are specified, the active controller will be used.\n             */\n             getBaseUrl = function( ip, token ) {\n                if ( ( token && isOTCToken( token ) ) || ( !ip && ( $rootScope.activeController && isOTCToken( $rootScope.activeController.auth ) ) ) ) {\n                    return OPENTHINGS_CLOUD_HOST + \"/forward/v1/\" + ( token || $rootScope.activeController.auth );\n                } else {\n                    return \"http://\" + ( ip || $rootScope.activeController.ip );\n                }\n            },\n            isOTCToken = function( token ) {\n                return token && token.startsWith( \"OT\" );\n            },\n\t\t\t$http, $q, $filter, $ionicPopup, $ionicModal;\n\n\t    if ( isFireFox ) {\n\t\t\tHTMLElement.prototype.click = function() {\n\t\t\t\tvar evt = this.ownerDocument.createEvent( \"MouseEvents\" );\n\t\t\t\tevt.initMouseEvent( \"click\", true, true, this.ownerDocument.defaultView, 1, 0, 0, 0, 0, false, false, false, false, 0, null );\n\t\t\t\tthis.dispatchEvent( evt );\n\t\t\t};\n\t    }\n\n        $rootScope.$on( \"controllersUpdated\", updateQuickLinks );\n\n\t    // Return usable functions\n\t    return {\n\t\t\tisIE: isIE,\n\t        storage: storage,\n\t        getControllerSettings: getControllerSettings,\n\t        getControllerOptions: getControllerOptions,\n\t        updateController: updateController,\n\t        setController: setController,\n\t        getControllerIndex: getControllerIndex,\n\t        checkNewController: checkNewController,\n\t        updateQuickLinks: updateQuickLinks,\n\t\t\tshowAddController: function( callback ) {\n\t\t\t\tcallback = callback || function() {};\n\t\t\t\t$ionicPopup = $ionicPopup || $injector.get( \"$ionicPopup\" );\n\n\t\t\t\tvar scope = $rootScope.$new();\n\t\t\t\tscope.data = {\n\t\t\t\t\tcanScan: window.networkinterface ? true : false\n\t\t\t\t};\n\t\t\t\tscope.scan = function() {\n\t\t\t\t\tscanLocalNetwork( function( result ) {\n\t\t\t\t\t\tif ( !result || !result.length ) {\n\t\t\t\t\t\t\t$ionicPopup.alert( {\n\t\t\t\t\t\t\t\ttemplate: \"<p class='center'>No devices detected on your network</p>\"\n\t\t\t\t\t\t\t} );\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tscope.data.foundControllers = result;\n\t\t\t\t\t} );\n\t\t\t\t};\n\t\t\t\tscope.save = function( ip ) {\n\t\t\t\t\tpopup.close();\n\t\t\t\t\trequestPassword( function( password ) {\n\t\t\t\t\t\taddController( {\n\t\t\t\t\t\t\tip: ip,\n\t\t\t\t\t\t\tpassword: password\n\t\t\t\t\t\t} );\n\t\t\t\t\t} );\n\t\t\t\t};\n\n\t\t\t\tvar popup = $ionicPopup.show( {\n\t\t\t\t\ttemplateUrl: \"templates/addController.html\",\n\t\t\t\t\ttitle: \"Add Controller\",\n\t\t\t\t\tscope: scope,\n\t\t\t\t\tbuttons: [\n\t\t\t\t\t\t{ text: \"Cancel\" },\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttext: \"<b>Add</b>\",\n\t\t\t\t\t\t\ttype: \"button-positive\",\n\t\t\t\t\t\t\tonTap: function( e ) {\n\t\t\t\t\t\t\t\tif ( !scope.data.ip || !scope.data.password ) {\n\t\t\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t]\n\t\t\t\t} );\n\n\t\t\t\tpopup.then(\n\t\t\t\t\tfunction( isValid ) {\n\t\t\t\t\t\tif ( isValid ) {\n\t\t\t\t\t\t\taddController( scope.data, callback );\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t},\n\t\t\tshowAddBlynk: function( callback ) {\n\t\t\t\tcallback = callback || function() {};\n\t\t\t\t$ionicPopup = $ionicPopup || $injector.get( \"$ionicPopup\" );\n\n\t\t\t\tvar scope = $rootScope.$new();\n\t\t\t\tscope.data = {};\n\t\t\t\tvar popup = $ionicPopup.show( {\n\t\t\t\t\ttemplateUrl: \"templates/addControllerBlynk.html\",\n\t\t\t\t\ttitle: \"Add Controller by Blynk\",\n\t\t\t\t\tscope: scope,\n\t\t\t\t\tbuttons: [\n\t\t\t\t\t\t{ text: \"Cancel\" },\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttext: \"<b>OK</b>\",\n\t\t\t\t\t\t\ttype: \"button-positive\",\n\t\t\t\t\t\t\tonTap: function( e ) {\n\t\t\t\t\t\t\t\tif ( !scope.data.token ) {\n\t\t\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t]\n\t\t\t\t} );\n\n\t\t\t\tpopup.then(\n\t\t\t\t\tfunction( isValid ) {\n\t\t\t\t\t\tif ( isValid ) {\n                            if ( !scope.data.bdmn ) {\n                                scope.data.bdmn = \"blynk-cloud.com\";\n                            }\n\n                            if ( !scope.data.bprt ) {\n                                scope.data.bprt = 80;\n                            }\n\n\t\t\t\t\t\t\taddController( scope.data, callback );\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t},\n\t\t\tshowAddOtc: function( callback ) {\n\t\t\t\tcallback = callback || function() {};\n\t\t\t\t$ionicPopup = $ionicPopup || $injector.get( \"$ionicPopup\" );\n\n\t\t\t\t$ionicPopup.prompt( {\n\t\t\t\t\ttitle: \"Add Controller by OpenThings Cloud\",\n\t\t\t\t\ttemplate: \"Enter your OpenThings Cloud auth token below:\",\n\t\t\t\t\tinputType: \"text\",\n\t\t\t\t\tinputPlaceholder: \"Your OpenThings Auth token\"\n\t\t\t\t} ).then( function( token ) {\n\t\t\t\t\tif ( token ) {\n\t\t\t\t\t\taddController( { token: token }, callback );\n\t\t\t\t\t}\n\t\t\t\t} );\n\t\t\t},\n\t\t\ttoggleDoor: function( auth, callback, blynkServer ) {\n\t\t\t\tif ( typeof auth === \"function\" ) {\n\t\t\t\t\tcallback = auth;\n\t\t\t\t\tauth = null;\n\t\t\t\t}\n\n\t\t\t\tcallback = callback || function() {};\n\t\t\t\t$http = $http || $injector.get( \"$http\" );\n\n\t\t\t\tvar promise;\n\n\t\t\t\tif ( ( auth && !isOTCToken( auth ) ) || ( $rootScope.activeController && $rootScope.activeController.auth && !isOTCToken( $rootScope.activeController.auth ) ) ) {\n                    if ( !blynkServer ) {\n                        if ( !$rootScope.activeController.bdmn ) {\n                            blynkServer = \"blynk-cloud.com\";\n                        } else {\n                            blynkServer = $rootScope.activeController.bdmn;\n                        }\n\n                        if ( $rootScope.activeController.bprt ) {\n                            blynkServer += \":\" + $rootScope.activeController.bprt;\n                        }\n                    }\n\n\t\t\t\t\tpromise = $http( {\n\t\t\t\t\t\tmethod: \"POST\",\n\t\t\t\t\t\turl: \"https://opengarage.io/wp-admin/admin-ajax.php\",\n\t\t                headers: { \"Content-Type\": \"application/x-www-form-urlencoded; charset=UTF-8\" },\n\t\t\t\t\t\tdata: \"action=blynkCloud&server=\" + encodeURIComponent( blynkServer ) + \"&path=\" + encodeURIComponent( ( auth || $rootScope.activeController.auth ) + \"/update/V1?value=1\" )\n\t\t\t\t\t} ).then( function() {\n\t\t\t\t\t\tsetTimeout( function() {\n\t\t\t\t\t\t\t$http( {\n\t\t\t\t\t\t\t\tmethod: \"POST\",\n\t\t\t\t\t\t\t\turl: \"https://opengarage.io/wp-admin/admin-ajax.php\",\n\t\t\t\t                headers: { \"Content-Type\": \"application/x-www-form-urlencoded; charset=UTF-8\" },\n\t\t\t\t                suppressLoader: true,\n\t\t\t\t\t\t\t\tdata: \"action=blynkCloud&server=\" + encodeURIComponent( blynkServer ) + \"&path=\" + encodeURIComponent( ( auth || $rootScope.activeController.auth ) + \"/update/V1?value=0\" )\n\t\t\t\t\t\t\t} );\n\t\t\t\t\t\t}, $rootScope.activeController.cdt || 1000 );\n\t\t\t\t\t} );\n\t\t\t\t} else {\n\t\t\t\t\tpromise = $http.get( getBaseUrl( null, auth ) + \"/cc?dkey=\" + encodeURIComponent( $rootScope.activeController.password ) + \"&click=1\" );\n\t\t\t\t}\n\n\t            promise.then(\n\t\t\t\t\tfunction() {\n\t\t\t\t\t\tcallback( true );\n\t\t\t\t\t},\n\t\t\t\t\tfunction() {\n\t\t\t\t\t\tcallback( false );\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t},\n\t\t\trestartController: function() {\n\t\t\t\t$http = $http || $injector.get( \"$http\" );\n\t\t\t\t$ionicPopup = $ionicPopup || $injector.get( \"$ionicPopup\" );\n\n\t\t\t\tif ( $rootScope.activeController ) {\n\t\t\t\t\t$ionicPopup.confirm( {\n\t\t\t\t\t\ttitle: \"Restart Controller?\",\n\t\t\t\t\t\ttemplate: \"<p class='center'>Are you sure you want to restart the controller?</p>\"\n\t\t\t\t\t} ).then( function( result ) {\n\t\t\t\t\t\tif ( result ) {\n\t\t\t\t\t\t\t$http.get( getBaseUrl() + \"/cc?dkey=\" + encodeURIComponent( $rootScope.activeController.password ) + \"&reboot=1\" );\n\t\t\t\t\t\t}\n\t\t\t\t\t} );\n\t\t\t\t}\n\t\t\t},\n\t\t\tsaveOptions: function( settings, callback ) {\n\t\t\t\t$http = $http || $injector.get( \"$http\" );\n\n\t            return $http( {\n\t                method: \"GET\",\n\t                url: getBaseUrl() + \"/co?dkey=\" + $rootScope.activeController.password,\n\t\t\t\t\tparams: settings,\n\t\t\t\t\tparamSerializer: \"$httpParamSerializerJQLike\"\n\t            } ).then(\n\t\t\t\t\tfunction( result ) {\n\t\t\t\t\t\tcallback( result.data );\n\t\t\t\t\t},\n\t\t\t\t\tfunction() {\n\t\t\t\t\t\tcallback( false );\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t},\n\t\t\tchangePassword: function() {\n\t\t\t\t$ionicPopup = $ionicPopup || $injector.get( \"$ionicPopup\" );\n\n\t\t\t\tvar scope = $rootScope.$new();\n\t\t\t\tscope.pwd = {};\n\n\t\t\t\t$ionicPopup.show( {\n\t\t\t\t\ttemplateUrl: \"templates/changePassword.html\",\n\t\t\t\t\ttitle: \"Change Password\",\n\t\t\t\t\tscope: scope,\n\t\t\t\t\tbuttons: [\n\t\t\t\t\t\t{ text: \"Cancel\" },\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttext: \"<b>Go</b>\",\n\t\t\t\t\t\t\ttype: \"button-positive\"\n\t\t\t\t\t\t}\n\t\t\t\t\t]\n\t\t\t\t} ).then( function() {\n\t\t\t\t\tif ( !scope.pwd.nkey || !scope.pwd.ckey || scope.pwd.nkey !== scope.pwd.ckey  ) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n                    $http = $http || $injector.get( \"$http\" );\n                    $filter = $filter || $injector.get( \"$filter\" );\n\n\t\t            $http( {\n\t\t                method: \"GET\",\n\t\t                url: getBaseUrl() + \"/co?dkey=\" + $rootScope.activeController.password,\n\t\t\t\t\t\tparams: scope.pwd,\n\t\t\t\t\t\tparamSerializer: \"$httpParamSerializerJQLike\"\n\t\t            } ).then( function() {\n\t\t\t\t\t\t$rootScope.activeController.password = scope.pwd.nkey;\n\n\t\t\t\t\t\tvar index = $rootScope.controllers.indexOf( ( $filter( \"filter\" )( $rootScope.controllers, { \"mac\": $rootScope.activeController.mac } ) || [] )[ 0 ] );\n\t\t\t\t\t\tif ( index ) {\n\t\t\t\t\t\t\t$rootScope.controllers[ index ] = $rootScope.activeController;\n\t\t\t\t\t\t\tstorage.set( { \"controllers\": JSON.stringify( $rootScope.controllers ), \"activeController\": JSON.stringify( $rootScope.activeController ) } );\n\t\t\t\t\t\t\t$rootScope.$broadcast( \"controllersUpdated\" );\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t$ionicPopup.alert( {\n\t\t\t\t\t\t\ttemplate: \"<p class='center'>Password updated succesfully!</p>\"\n\t\t\t\t\t\t} );\n\t\t\t\t\t} );\n\t\t\t\t} );\n\t\t\t},\n\t\t\tgetLogs: function( callback ) {\n\t\t\t\tif ( !$rootScope.activeController || ( !$rootScope.activeController.ip && !isOTCToken( $rootScope.activeController.auth ) ) ) {\n\t\t\t\t\tcallback( false );\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\t$http = $http || $injector.get( \"$http\" );\n\n\t            $http( {\n\t                method: \"GET\",\n\t                url: getBaseUrl() + \"/jl\"\n\t            } ).then(\n\t\t\t\t\tfunction( result ) {\n\t\t\t\t\t\tcallback( result.data.logs.sort( function( a, b ) { return b[ 0 ] - a[ 0 ]; } ) );\n\t\t\t\t\t},\n\t\t\t\t\tfunction() {\n\t\t\t\t\t\tcallback( false );\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t},\n\t\t\tselectPhoto: function( $event, index, deletePhoto ) {\n\t\t\t\t$ionicModal = $ionicModal || $injector.get( \"$ionicModal\" );\n\n\t\t\t\tvar scope = $rootScope.$new(),\n\t\t\t\t\tfileInput = angular.element( document.getElementById( \"photoUpload\" ) );\n\n\t\t\t\tscope.data = {\n\t\t\t\t\timage: false,\n\t\t\t\t\tcropped: false,\n\t\t\t\t\tindex: false\n\t\t\t\t};\n\n\t\t\t\tscope.uploadPhoto = function( index ) {\n\t\t\t\t\tscope.crop.hide();\n\n\t\t\t\t\tif ( getControllerIndex() === index ) {\n\t\t\t\t\t\t$rootScope.activeController.image = scope.data.cropped;\n\t\t\t\t\t\tstorage.set( { activeController: JSON.stringify( $rootScope.activeController ) } );\n\t\t\t\t\t}\n\n\t\t\t\t\t$rootScope.controllers[ index ].image = scope.data.cropped;\n\t\t\t        storage.set( { controllers: JSON.stringify( $rootScope.controllers ) } );\n\t\t\t        $rootScope.$broadcast( \"controllersUpdated\" );\n\t\t\t\t};\n\n\t\t\t\t$ionicModal.fromTemplateUrl( \"templates/crop.html\", {\n\t\t\t\t\tscope: scope\n\t\t\t\t} ).then( function( modal ) {\n\t\t\t\t\tscope.crop = modal;\n\t\t\t\t} );\n\n\t\t\t\t$event.stopPropagation();\n\n\t\t\t\tif ( deletePhoto ) {\n\t\t\t\t\tif ( getControllerIndex() === index ) {\n\t\t\t\t\t\tdelete $rootScope.activeController.image;\n\t\t\t\t\t\tstorage.set( { activeController: JSON.stringify( $rootScope.activeController ) } );\n\t\t\t\t\t}\n\n\t\t\t\t\tdelete $rootScope.controllers[ index ].image;\n\t\t\t        storage.set( { controllers: JSON.stringify( $rootScope.controllers ) } );\n\t\t\t        $rootScope.$broadcast( \"controllersUpdated\" );\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tfileInput.parent()[ 0 ].reset();\n\n\t\t\t\tfileInput.one( \"change\", function() {\n\t\t\t\t\tvar file = fileInput[ 0 ].files[ 0 ];\n\n\t\t\t\t\tif ( !file.type || !file.type.match( \"image.*\" ) ) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tvar reader = new FileReader();\n\t\t\t\t\treader.onload = function( evt ) {\n\t\t\t\t\t\tscope.data.image = evt.target.result;\n\t\t\t\t\t\tscope.data.index = index;\n\t\t\t\t\t\tscope.crop.show();\n\t\t\t\t\t};\n\t\t\t\t\treader.readAsDataURL( file );\n\t\t\t\t} );\n\n\t\t\t\tfileInput[ 0 ].click();\n\t\t\t}\n\t    };\n} ] );\n\n/* global angular */\n\n// OpenGarage\nangular.module( \"opengarage.watch\", [] )\n    .factory( \"Watch\", [ \"$rootScope\", function( $rootScope ) {\n\n\t\tvar loadApp = function() {\n            window.applewatch.loadAppMain( {\n                title: \"OpenGarage\",\n                label: {\n                    value: \"Toggle Garage Door\",\n                    color: \"#FFA500\",\n                    font: {\n                        size: 12\n                    }\n                },\n                table: {\n                    callback: \"toggleDoorByIndex\",\n                    alpha: 1,\n                    rows: makeAppList()\n                }\n            } );\n        },\n        makeAppList = function() {\n            var rows = [];\n\n            $rootScope.controllers.forEach( function( controller ) {\n\t\t\t\tvar item = {\n                    type: \"OneColumnSelectableRowType\",\n                    group: {\n                        backgroundColor: \"#1884C4\",\n                        cornerRadius: 8\n                    },\n                    label: {\n                        value: \" \" + controller.name\n                    }\n                };\n\n                if ( controller.image ) {\n\n\t\t\t\t\tvar canvas = document.createElement( \"canvas\" ),\n\t\t\t\t\t\tctx = canvas.getContext( \"2d\" ),\n\t\t\t\t\t\timg = new Image();\n\n\t\t\t\t\timg.src = controller.image;\n\n\t\t\t\t\tcanvas.width = 25;\n\t\t\t\t\tcanvas.height = 30;\n\t\t\t\t\tctx.drawImage( img, 0, 0, canvas.width, canvas.height );\n\n\t\t\t\t\titem.imageLeft = {\n                        data: canvas.toDataURL( \"image/png\" ),\n                        width: canvas.width,\n                        height: canvas.height\n                    };\n                }\n\n                rows.push( item );\n            } );\n\n            return rows;\n        };\n\n        $rootScope.$on( \"controllersUpdated\", function() {\n            if ( window.applewatch ) {\n                loadApp();\n            }\n        } );\n\n        return {\n            loadApp: loadApp\n        };\n    } ] );\n"],"names":["angular","module","run","$state","$ionicPlatform","$ionicScrollDelegate","$document","$window","$rootScope","$filter","$ionicLoading","$timeout","Utils","Cloud","Watch","ready","handleGeofence","open","url","window","SafariViewController","isAvailable","available","show","tintColor","barColor","controlTintColor","cordova","plugins","Keyboard","hideKeyboardAccessoryBar","StatusBar","styleLightContent","backgroundColorByHexString","element","on","scrollTop","geofence","hasGeofence","startGeofence","callback","initialize","then","getWatched","fences","geoFences","JSON","parse","geofences","notification","$apply","forEach","geo","data","id","split","controller","controllers","mac","door","toggleDoor","auth","bdmn","bprt","onTransitionReceived","onNotificationClicked","ThreeDeeTouch","updateQuickLinks","enableLinkPreview","onHomeIconPressed","payload","type","applewatch","navigator","simulator","init","noop","toggleDoorByIndex","index","onLoadAppMainRequest","loadApp","splashscreen","hide","err","connected","version","appVersion","loadingQueue","$on","e","scope","$new","canceller","resolve","$broadcast","push","template","pop","length","title","checkNewController","sync","firstLoadHandler","event","preventDefault","storage","get","activeController","Object","keys","go","updateController","cloudToken","content","document","getElementById","innerWidth","width","config","$stateProvider","$httpProvider","$compileProvider","$ionicConfigProvider","test","userAgent","platform","default","spinner","icon","backButton","previousTitleText","text","scrolling","jsScrolling","aHrefSanitizationWhitelist","imgSrcSanitizationWhitelist","state","templateUrl","abstract","views","menuContent","checkValid","$q","total","filterFilter","invalidOrg","remove","reject","setController","interceptors","$injector","request","match","cancel","defer","timeout","promise","retryCount","suppressLoader","response","responseError","error","$http","$$state","status","canceled","retryFailed","forwardCache","filter","items","filterOn","newItems","extractValueToCompare","isUndefined","isArray","item","isObject","isString","isDuplicate","i","equals","directive","restrict","replace","rule","link","map","marker","circle","updateRule","addOrUpdate","direction","latitude","start","lat","longitude","lng","radius","transitionType","openAppOnClick","updateMarker","setMap","google","maps","Marker","position","updateRadius","Circle","strokeColor","strokeOpacity","strokeWeight","fillColor","fillOpacity","center","parseInt","updateMap","enable","setTimeout","Map","querySelectorAll","zoom","streetViewControl","mapTypeControl","addListener","latLng","$watch","currentRule","geolocation","getCurrentPosition","coords","factory","login","user","pass","$httpParamSerializerJQLike","method","headers","Content-Type","action","username","password","result","token","set","cloudDataToken","sjcl","codec","hex","fromBits","hash","sha256","isSynced","loggedin","syncStart","$ionicActionSheet","getSites","sites","finish","stringify","saveSites","buttons","titleText","cancelText","buttonClicked","concat","$ionicPopup","requestAuth","onTap","isValid","local","undefined","handleInvalidDataToken","success","controllerType","message","handleExpiredLogin","decrypt","encodeURIComponent","encrypt","prompt","subTitle","inputType","inputPlaceholder","confirm","logout","getTokenUser","atob","$scope","submit","alert","skipCloud","$ionicHistory","showDelete","selectPhoto","nextViewOptions","historyRoot","deleteController","getControllerIndex","splice","moveItem","fromIndex","toIndex","getTime","timestamp","Date","toLocaleString","changeSync","isLocal","getLogs","reply","current","day","toDateString","isDivider","logs","settings","changePassword","restart","restartController","saveOptions","getControllerOptions","mod","fwv","$ionicSideMenuDelegate","sideMenuDraggable","showAddController","showAddBlynk","showAddOtc","closeMenu","toggleLeft","interval","currentIndex","changeController","to","clearInterval","setInterval","reset","home","away","isAndroid","ionic","Platform","OPENTHINGS_CLOUD_HOST","getControllerSettings","ip","blynkServer","isOTCToken","all","name","vehicle","getBaseUrl","lastUpdate","updatedAt","showLoader","copy","extend","addController","scanLocalNetwork","networkinterface","getWiFiIPAddress","address","router","baseip","join","queue","matches","catch","links","limit","iconType","configureQuickActions","$ionicModal","isFireFox","isIE","query","hasOwnProperty","localStorage","getItem","setItem","removeItem","ssids","save","modal","ssid","saveNewController","fromTemplateUrl","animation","int","startsWith","HTMLElement","prototype","click","evt","this","ownerDocument","createEvent","initMouseEvent","defaultView","dispatchEvent","pendingRequests","pendingReq","popup","canScan","scan","foundControllers","close","cdt","params","paramSerializer","pwd","nkey","ckey","indexOf","sort","a","b","$event","deletePhoto","fileInput","image","cropped","uploadPhoto","crop","stopPropagation","parent","one","reader","file","files","FileReader","onload","target","readAsDataURL","rows","loadAppMain","label","value","color","font","size","table","alpha","canvas","ctx","img","group","backgroundColor","cornerRadius","createElement","getContext","Image","src","height","drawImage","imageLeft","toDataURL"],"mappings":"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"}